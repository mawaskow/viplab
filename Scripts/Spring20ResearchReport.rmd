---
title: "Spring 2020 Research Report"
author: "mawaskow"
date: "5/12/2020"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### VIP Lab
Aside from my work in the USGS river digitizing project, this semester I have been doing work in the VIPLab concerning the problem of determining the ideal drone height over data collection sites.

This problem, and the research project design in order to solve it, require a myriad of background information.

Given a selection of data recorded in the past, I generated DSMs, DTMs, CHMs, and orthophotos from various softwares and have compiled them in this report so that their outputs and quality can be compared.


### Initial Data
The data recorded in the past was:
```{r echo= FALSE, results = 'asis'}
table1 <- read.csv("quasimetadata.csv", header = TRUE, sep = ",")
library(knitr)
kable(table1)
```


### Code
Below is the R code which takes the path of a folder containing DSMs and DTMs (if the files are labelled appropriately), and outputs to that same file CHMs with names corresponding to the names of their respective DSMs and DTMs:

```
library(raster)
library(rgdal)
###

generate_chm <- function(dtmfilename, dsmfilename, chmoutfilename){
  dtm_raster <- raster(dtmfilename)
  dsm_raster <- raster(dsmfilename)
  chm_raster <- dsm_raster - dtm_raster
  writeRaster(chm_raster, chmoutfilename,
              format= "GTiff", overwrite = TRUE)
}

dsmfiles <- c(list.files("Data", pattern = "*DSM.tif", full.names = 'True'))
dtmfiles <- c(list.files("Data", pattern = "*DTM.tif", full.names = 'True'))

for (i in seq_along(dsmfiles)){
  len = nchar(dsmfiles[i])
  begin = substr(dsmfiles[i], 1, len-7)
  end = "CHM.tif"
  chmname = paste(begin, end, sep = "")
  generate_chm(dtmfiles[i], dsmfiles[i], chmname)
}
```

What follows is the R code which takes the path of a folder containing orthophotos and (if the files are labeled correctly) outputs an NDVI to the same folder with a name corresponding to the name of the orthophoto file.
```
library(raster)
library(rgdal)
library(rgeos)
library(RColorBrewer)

##### function #####
generate_ndvi <- function(orthophotoinfile, ndvioutfile){
  options(stringsAsFactors = FALSE)
  orthoforndvi <- stack(orthophotoinfile)
  orthoforndvi_brick <- brick(orthoforndvi)
  r_brick <- orthoforndvi_brick[[1]]
  nir_brick <- orthoforndvi_brick[[4]]
  ndvicalc <- (nir_brick - r_brick) / (nir_brick + r_brick)
  writeRaster(x = ndvicalc,
              filename= ndvioutfile, format = "GTiff", datatype='INT2S', overwrite = TRUE)
}

##### Here (the "Data" entry) is where you select the folder path from which you will select the files #####
filenames <- c(list.files("Data", pattern = "*orthophoto.tif", full.names = 'True'))

##### main code #####
for (i in seq_along(filenames)){
  len = nchar(filenames[i])
  begin = substr(filenames[i], 1, len-14)
  end = "NDVI.tif"
  ndviname = paste(begin, end, sep = "")
  generate_ndvi(filenames[i], ndviname)
}
```

### Program Outputs

#### WebODM
#### DSMs and DTMs
Maricopa DSM
![Maricopa DSM](Data/WebODM/Rversions/MaricopaDSM.png) 
Maricopa DTM
![Maricopa DTM](Data/WebODM/Rversions/MaricopaDTM.png)

Flagstaff DSM
![Flagstaff DSM](Data/WebODM/Rversions/FlagstaffDSM.png) 
Flagstaff DTM
![Flagstaff DTM](Data/WebODM/Rversions/FlagstaffDTM.png)

Flagstaff2 DSM
![Flagstaff2 DSM](Data/WebODM/Rversions/Flagstaff2DSM.png) 
Flagstaff2 DTM
![Flagstaff2 DTM](Data/WebODM/Rversions/Flagstaff2DTM.png)

Flagstaff3 DSM
![Flagstaff3 DSM](Data/WebODM/Rversions/Flagstaff3DSM.png) 
Flagstaff3 DTM
![Flagstaff3 DTM](Data/WebODM/Rversions/Flagstaff3DTM.png)

Santa Rita DSM
![Santa Rita DSM](Data/WebODM/Rversions/SantaRitaDSM.png) 
Santa Rita DTM
![Santa Rita DTM](Data/WebODM/Rversions/SantaRitaDTM.png)

Santa Rita Project 1 DSM
![Santa Rita Project 1 DSM](Data/WebODM/Rversions/SantaRita1DSM.png) 
Santa Rita Project 1 DTM
![Santa Rita Project 1 DTM](Data/WebODM/Rversions/SantaRita1DTM.png)

Santa Rita Project 3 DSM
![Santa Rita Project 3 DSM](Data/WebODM/Rversions/SantaRita3DSM.png) 
Santa Rita Project 3 DTM
![Santa Rita Project 3 DTM](Data/WebODM/Rversions/SantaRita3DTM.png)

Santa Rita Project 5 DSM
![Santa Rita Project 5 DSM](Data/WebODM/Rversions/SantaRita5DSM.png) 
Santa Rita Project 5 DTM
![Santa Rita Project 5 DTM](Data/WebODM/Rversions/SantaRita5DTM.png)

#### CHMs
Maricopa CHM
![Maricopa CHM](Data/WebODM/Rversions/MaricopaCHM.png)
Flagstaff CHM
![Flagstaff CHM](Data/WebODM/Rversions/FlagstaffCHM.png)
Flagstaff2 CHM
![Flagstaff2 CHM](Data/WebODM/Rversions/Flagstaff2CHM.png)
Flagstaff3 CHM
![Flagstaff3 CHM](Data/WebODM/Rversions/Flagstaff3CHM.png)
Santa Rita CHM
![Santa Rita CHM](Data/WebODM/Rversions/SantaRitaCHM.png)
Santa Rita Project 1 CHM
![Santa Rita Project 1 CHM](Data/WebODM/Rversions/SantaRita1CHM.png)
Santa Rita Project 3 CHM
![Santa Rita Project 3 CHM](Data/WebODM/Rversions/SantaRita3CHM.png)
Santa Rita Project 5 CHM
![Santa Rita Project 5 CHM](Data/WebODM/Rversions/SantaRita5CHM.png)

#### Orthophotos
Maricopa Orthophoto
![Maricopa Orthophoto](Data/WebODM/pngorthophotos/Maricopaorthophoto.png)
Flagstaff Orthophoto
![Flagstaff Orthophoto](Data/WebODM/pngorthophotos/Flagstafforthophoto.png)
Flagstaff2 Orthophoto
![Flagstaff2 Orthophoto](Data/WebODM/pngorthophotos/Flagstaff2orthophoto.png)
Flagstaff3 Orthophoto
![Flagstaff3 Orthophoto](Data/WebODM/pngorthophotos/Flagstaff3orthophoto.png)
Santa Rita Orthophoto
![Santa Rita Orthophoto](Data/WebODM/pngorthophotos/SantaRitaorthophoto.png) 
Santa Rita Project 1 Orthophoto
![Santa Rita Project 1 Orthophoto](Data/WebODM/pngorthophotos/SantaRita1orthophoto.png)
Santa Rita Project 3 Orthophoto
![Santa Rita Project 3 Orthophoto](Data/WebODM/pngorthophotos/SantaRita3orthophoto.png)
Santa Rita Project 5 Orthophoto
![Santa Rita Project 5 Orthophoto](Data/WebODM/pngorthophotos/SantaRita5orthophoto.png)

#### NDVIs
Maricopa NDVI
![Maricopa NDVI](Data/WebODM/Rversions/MaricopaNDVI.png)
Flagstaff NDVI
![Flagstaff NDVI](Data/WebODM/Rversions/FlagstaffNDVI.png)
Flagstaff2 NDVI
![Flagstaff2 NDVI](Data/WebODM/Rversions/Flagstaff2NDVI.png)
Flagstaff3 NDVI
![Flagstaff3 NDVI](Data/WebODM/Rversions/Flagstaff3NDVI.png)
Santa Rita NDVI
![Santa Rita NDVI](Data/WebODM/Rversions/SantaRitaNDVI.png) 
Santa Rita Project 1 NDVI
![Santa Rita Project 1 NDVI](Data/WebODM/Rversions/SantaRita1NDVI.png)
Santa Rita Project 3 NDVI
![Santa Rita Project 3 NDVI](Data/WebODM/Rversions/SantaRita3NDVI.png)
Santa Rita Project 5 NDVI
![Santa Rita Project 5 NDVI](Data/WebODM/Rversions/SantaRita5NDVI.png)
